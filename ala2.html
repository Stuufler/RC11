<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Generador de Audios - ElevenLabs</title>
  <style>
    :root {
      --bg: #f9f9fb;
      --card: #ffffff;
      --primary: #37474f;
      --secondary: #607d8b;
      --accent: #4caf50;
      --border: #e0e0e0;
      --shadow: rgba(0, 0, 0, 0.04);
    }

    body {
      margin: 0;
      font-family: 'Segoe UI', Roboto, sans-serif;
      background-color: var(--bg);
      color: var(--primary);
      padding: 20px;
    }

    h2 {
      text-align: center;
      color: var(--secondary);
      margin-bottom: 30px;
    }

    .container {
      max-width: 700px;
      margin: 0 auto;
    }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 10px;
      box-shadow: 0 4px 10px var(--shadow);
      padding: 20px;
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 10px;
      font-weight: 600;
    }

    input[type="text"],
    input[type="number"],
    textarea {
      width: 100%;
      max-width: 100%;
      padding: 10px;
      font-size: 1rem;
      border: 1px solid var(--border);
      border-radius: 6px;
      margin-top: 5px;
      margin-bottom: 15px;
      box-sizing: border-box;
    }

    textarea {
      height: 120px;
      resize: vertical;
    }

    button {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      background-color: var(--accent);
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    button:hover {
      background-color: #388e3c;
    }

    .actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    audio {
      margin-top: 15px;
      width: 100%;
    }
  </style>
</head>
<body>

<div class="container">
  <h2>üéß Generador de Audio ElevenLabs</h2>

  <div class="card">
    <label>
      üîë API Token:
      <input type="text" id="apiKeyInput" placeholder="Introduce tu API key aqu√≠">
    </label>

    <label>
      üìù Texto (cualquier idioma):
      <textarea id="textInput" placeholder="Escribe aqu√≠ el texto que quieres convertir en audio..."></textarea>
    </label>

    <label>
      üé≤ Seed:
      <input type="range" id="seedSlider" min="0" max="4294967295" step="1">
      <input type="number" id="seedInput" min="0" max="4294967295" step="1">
      <button id="randomizeSeedBtn">Generar aleatorio</button>
    </label>

    <div class="actions">
      <button id="playBtn">‚ñ∂Ô∏è Escuchar</button>
      <button id="downloadBtn">‚¨áÔ∏è Descargar</button>
    </div>

    <audio id="audioPlayer" controls style="display:none;"></audio>
  </div>
</div>

<script>
const voiceId = "flHkNRp1BlvT73UL6gyz";
const apiKeyInput = document.getElementById('apiKeyInput');
const textInput = document.getElementById('textInput');
const seedSlider = document.getElementById('seedSlider');
const seedInput = document.getElementById('seedInput');
const randomizeSeedBtn = document.getElementById('randomizeSeedBtn');
const playBtn = document.getElementById('playBtn');
const downloadBtn = document.getElementById('downloadBtn');
const audioPlayer = document.getElementById('audioPlayer');

// –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–ª–∑—É–Ω–∫–∞ –∏ –ø–æ–ª—è
seedSlider.addEventListener('input', () => seedInput.value = seedSlider.value);
seedInput.addEventListener('input', () => seedSlider.value = seedInput.value);
randomizeSeedBtn.addEventListener('click', () => {
  const r = Math.floor(Math.random() * 4294967296);
  seedInput.value = seedSlider.value = r;
});

async function generateAudioBlob(apiKey, text, seed) {
  const body = {
    text: text,
    model_id: "eleven_multilingual_v2",
    ...(seed !== null ? { seed: seed } : {})
  };

  const response = await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${voiceId}?output_format=mp3_44100_192`, {
    method: "POST",
    headers: {
      "xi-api-key": apiKey,
      "Content-Type": "application/json"
    },
    body: JSON.stringify(body)
  });

  if (!response.ok) {
    const err = await response.text();
    alert(`Error: ${response.status}\n${err}`);
    throw new Error(err);
  }

  return await response.blob();
}

playBtn.addEventListener('click', async () => {
  const apiKey = apiKeyInput.value.trim();
  const text = textInput.value.trim();
  const seed = seedInput.value ? parseInt(seedInput.value) : null;

  if (!apiKey || !text) {
    alert("Introduce tanto el API token como el texto.");
    return;
  }

  const blob = await generateAudioBlob(apiKey, text, seed);
  audioPlayer.src = URL.createObjectURL(blob);
  audioPlayer.style.display = 'block';
  audioPlayer.play();
});

downloadBtn.addEventListener('click', async () => {
  const apiKey = apiKeyInput.value.trim();
  const text = textInput.value.trim();
  const seed = seedInput.value ? parseInt(seedInput.value) : null;

  if (!apiKey || !text) {
    alert("Introduce tanto el API token como el texto.");
    return;
  }

  const blob = await generateAudioBlob(apiKey, text, seed);
  const firstWord = text.split(/\s+/)[0] || "audio";
  const filename = `${seed ?? "random"}-${firstWord}.mp3`;

  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = filename;
  link.click();
});
</script>

</body>
</html>